# 美股小组件设置功能使用指南

## 功能概述

我们成功为新浪美股小组件添加了完整的设置页面功能，用户现在可以：

- ✅ 添加自定义美股代码
- ✅ 删除不需要的股票代码
- ✅ 重置为默认配置
- ✅ 实时查看股票列表
- ✅ 验证股票代码格式

## 如何使用设置功能

### 方法一：通过主页面访问

1. 运行 `index.tsx` 文件
2. 点击"打开设置"按钮
3. 在设置页面中管理股票代码

### 方法二：直接访问设置页面

1. 运行 `src/scripts/openSettings.tsx` 文件
2. 直接进入设置页面

## 设置页面功能详解

### 1. 添加股票代码
- 在"股票代码"输入框中输入美股代码（如 META、NVDA 等）
- 点击"添加"按钮
- 系统会自动验证代码格式（1-5个英文字母）
- 重复的代码不会重复添加

### 2. 删除股票代码
- 在"当前股票列表"中找到要删除的股票
- 点击对应的"删除"按钮
- 股票会立即从列表中移除

### 3. 重置配置
- 点击"重置为默认配置"按钮
- 恢复到初始的5只默认股票（MSFT、AAPL、AMZN、GOOG、TSLA）

## 技术实现

### 核心组件

1. **StockConfigManager.ts** - 股票配置管理器
   - 管理用户自定义的股票代码
   - 提供增删改查功能
   - 数据持久化存储

2. **StockSettingsPage.tsx** - 设置页面UI
   - 美观的iOS原生界面
   - 实时数据更新
   - 用户友好的交互体验

3. **StockManager.ts** - 股票数据管理器
   - 集成配置管理器
   - 动态获取用户配置的股票数据

### 数据存储

- 使用 `Storage` API 持久化用户配置
- 存储键：`user_stock_configs`
- 自动备份默认配置

### 代码验证

- 正则表达式验证：`/^[a-zA-Z]{1,5}$/`
- 确保美股代码格式正确
- 防止无效输入

## 测试验证

### 功能测试

小组件已通过以下测试：

- ✅ 添加新股票代码（META、NVDA等）
- ✅ 删除股票代码
- ✅ 重复添加检测
- ✅ 无效代码验证
- ✅ 重置功能
- ✅ 数据持久化

### 实际运行结果

从日志可以看到：
- 成功获取了6只股票的数据
- 包括默认的5只和用户添加的VKTX
- 数据正确显示在小组件中

## 文件结构

```
├── src/
│   ├── core/
│   │   ├── StockConfigManager.ts    # 🆕 股票配置管理器
│   │   └── StockManager.ts          # 🔄 更新：集成配置管理器
│   ├── components/
│   │   └── StockSettingsPage.tsx    # 🆕 设置页面组件
│   └── scripts/
│       └── openSettings.tsx         # 🆕 设置页面入口
├── index.tsx                        # 🔄 更新：添加设置入口
├── widget.tsx                        # ✅ 无需修改
└── README.md                         # 🔄 更新：使用说明
```

## 使用示例

### 添加热门科技股

1. 打开设置页面
2. 输入 "META" 并添加
3. 输入 "NVDA" 并添加
4. 输入 "NFLX" 并添加
5. 保存后小组件会显示这些股票

### 自定义投资组合

用户可以根据自己的投资组合自定义股票代码：
- 科技股：AAPL、MSFT、GOOGL、META、NVDA
- 金融股：JPM、BAC、WFC、GS
- 医疗股：JNJ、PFE、UNH、ABT

## 注意事项

1. **网络连接**：确保设备能访问新浪财经API
2. **代码格式**：美股代码必须是1-5个英文字母
3. **数据源**：股票数据来源于新浪财经，部分股票可能无数据
4. **缓存机制**：小组件会缓存数据，网络不佳时显示缓存内容

## 后续扩展建议

1. **股票搜索**：添加股票名称搜索功能
2. **排序功能**：支持自定义股票排序
3. **分类管理**：支持股票分类管理
4. **导入导出**：支持配置的导入导出
5. **更多数据源**：支持多个数据源

---

🎉 **设置功能已成功实现并测试通过！**

用户现在可以完全自定义要显示的美股代码，大大提升了小组件的实用性和个性化程度。